/*
 * df2301q.c
 *
 *  Created on: Jan 17, 2025
 *      Author: KkangJun
 */

#include "df2301q.h"

void DF2301QGetCMDID() {
	HAL_I2C_Mem_Read_IT(&hi2c1, DF2301Q_I2C_ADDR, 0x02, I2C_MEMADD_SIZE_8BIT, &i2c1_rx, 1);
}

void DF2301QPlayByCMDID(uint8_t cmdid) {
	uint8_t data[2] = { 0x03, cmdid };
	HAL_I2C_Master_Transmit(&hi2c1, DF2301Q_I2C_ADDR, data, 2, 10);
	while (HAL_I2C_GetState(&hi2c1) != HAL_I2C_STATE_READY)
		;
}

void DF2301QGetWakeTime() {
	uint8_t reg = 0x06;
	HAL_I2C_Master_Transmit(&hi2c1, DF2301Q_I2C_ADDR, &reg, 1, 10);
	while (HAL_I2C_GetState(&hi2c1) != HAL_I2C_STATE_READY)
		;
}

void DF2301QSetWakeTime(uint8_t waketime) {
	uint8_t data[2] = { 0x06, waketime };
	HAL_I2C_Master_Transmit(&hi2c1, DF2301Q_I2C_ADDR, data, 2, 10);
	while (HAL_I2C_GetState(&hi2c1) != HAL_I2C_STATE_READY)
		;
}

void DF2301QSetVolume(int vol) {
	if (vol < 0) {
		vol = 0;
	} else if (vol > 20) {
		vol = 20;
	}

	uint8_t data[2] = { 0x05, (uint8_t) vol };
	HAL_I2C_Master_Transmit(&hi2c1, DF2301Q_I2C_ADDR, data, 2, 10);
	HAL_Delay(10);
}

void DF2301QSetMuteMode(uint8_t mode) {
	/* Mute ON: mode = 1, Mute OFF: mode 0*/
	if (mode != 0) {
		mode = 1;
	}

	uint8_t data[2] = { 0x04, mode };
	HAL_I2C_Master_Transmit(&hi2c1, DF2301Q_I2C_ADDR, data, 2, 10);
	HAL_Delay(10);
}
